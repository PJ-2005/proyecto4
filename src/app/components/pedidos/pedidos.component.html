<div class="container mt-4">
  <h2 class="mb-4 text-center">üîç Buscar pedidos por cliente</h2>

  <div class="input-group mb-3">
    <input 
      type="text" 
      [(ngModel)]="nombreCliente" 
      class="form-control" 
      placeholder="Ingrese el nombre del cliente (ej. PEREZ CASTRO JORGE)" 
    />
    <button class="btn btn-primary" (click)="buscarPedidosPorCliente()">Buscar</button>
  </div>

  <!-- Tabla de pedidos -->
  <div *ngIf="pedidos.length > 0; else noPedidos">
    <table class="table table-striped table-bordered">
      <thead class="table-dark text-center">
        <tr>
          <th>ID Pedido</th>
          <th>ID Empleado</th>
          <th>Cliente</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of pedidos" class="text-center align-middle">
          <td>{{ p.idpedido }}</td>
          <td>{{ p.idemp }}</td>
          <td>{{ p.cliente?.nombre }}</td>
          <td>
            <span 
              class="badge" 
              [ngClass]="{
                'bg-success': p.estado === 'EMITIDO',
                'bg-warning': p.estado === 'POR ENVIAR',
                'bg-secondary': p.estado !== 'EMITIDO' && p.estado !== 'POR ENVIAR'
              }">
              {{ p.estado }}
            </span>
          </td>
          <td>
            <button class="btn btn-info btn-sm" (click)="verDetalles(p.idpedido)">
              Ver Detalle
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Mensaje cuando no hay pedidos -->
  <ng-template #noPedidos>
    <div *ngIf="nombreCliente" class="text-center text-muted mt-3">
      <p>No se encontraron pedidos para este cliente.</p>
    </div>
  </ng-template>
</div>

<!-- Modal Detalle -->
<div class="modal-backdrop" *ngIf="mostrarModal">
  <div class="modal-container">
    <div class="modal-content p-4">
      <h4 class="mb-3 text-center">üßæ Detalles del Pedido #{{ pedidoSeleccionado }}</h4>

      <table class="table table-bordered" *ngIf="detalles.length > 0; else sinDetalles">
        <thead class="table-secondary text-center">
          <tr>
            <th>Producto</th>
            <th>Cantidad</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let d of detalles" class="text-center align-middle">
            <td>{{ d.producto?.nombre }}</td>
            <td>{{ d.cant }}</td>
          </tr>
        </tbody>
      </table>

      <ng-template #sinDetalles>
        <p class="text-center text-muted">No hay detalles disponibles para este pedido.</p>
      </ng-template>

      <div class="text-center mt-4">
        <button class="btn btn-danger" (click)="cerrarModal()">Cerrar</button>
      </div>
    </div>
  </div>
</div>
